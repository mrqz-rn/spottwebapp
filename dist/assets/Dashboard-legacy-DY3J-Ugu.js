System.register(["./index-legacy-BI8T41NF.js"],(function(t,e){"use strict";var a,s,i,n,o,l,r,c,d,u,h,m,g,p,f,b,y,_,w,k,I,v,x,D,L,$,C,S,T,U,A,z,B,N,E,P,V,j,O;return{setters:[t=>{a=t._,s=t.I,i=t.x,n=t.y,o=t.z,l=t.e,r=t.A,c=t.f,d=t.d,u=t.b,h=t.B,m=t.C,g=t.D,p=t.E,f=t.F,b=t.G,y=t.H,_=t.J,w=t.K,k=t.L,I=t.M,v=t.N,x=t.O,D=t.P,L=t.Q,$=t.c,C=t.w,S=t.r,T=t.o,U=t.m,A=t.n,z=t.p,B=t.a,N=t.t,E=t.R,P=t.S,V=t.T,j=t.q,O=t.s}],execute:function(){var e=document.createElement("style");e.textContent=".header[data-v-4f198ab8]{font-size:6vh;font-weight:600;color:#000;text-align:center}.subheader[data-v-4f198ab8]{font-size:2.8vh;font-weight:600;color:#000;text-align:center}\n",document.head.appendChild(e);const W={components:{IonPage:s,IonToast:i,IonContent:n,IonCard:o,IonCardTitle:l,IonCardContent:r,IonLabel:c,IonInput:d,IonButton:u,IonSpinner:h,IonList:m,IonModal:g,IonTextarea:p,IonItem:f,IonIcon:b},data:()=>({eye:y,book:_,camera:w,save:k,close:I,arrowUndo:v,snackbar:{status:!1,type:"success",message:"test"},session_user:{},user_location:"",user_device:"",attlogs:[],display:{time:"00:00",date:"00/00/0000",datefrom:"00/00/0000",dateto:"00/00/0000"},current:{time:"00:00",date:"00/00/0000",datefrom:"00/00/0000",dateto:"00/00/0000"},btnvalid:!0,trxmodetype:0,background_count:0,location_bk:{latitude:0,longitude:0},location:{latitude:0,longitude:0}}),beforeCreate(){setInterval((()=>{this.getTimeDate()}),1e3)},async mounted(){const t=new Date;t.setDate(t.getDate()-15),this.current.datefrom=t.toLocaleDateString("en-CA"),this.display.datefrom=this.$function.formatDate(t.toLocaleDateString("en-CA")),this.current.dateto=(new Date).toLocaleDateString("en-CA"),this.display.dateto=this.$function.formatDate((new Date).toLocaleDateString("en-CA")),this.user_device=await this.$function.getDeviceInfo(),await this.initialize(),this.user_location||(console.log("test"),await this.fetchUserLocations())},methods:{async initialize(){this.session_user=await this.$function.getUser(),this.user_location=await this.$function.UserLocation(),this.snackbar.status=!0,this.snackbar.type="info",this.snackbar.message="Initializing location...";let t=await this.$function.getLocation();1==t.status&&(this.snackbar.type="success",this.snackbar.message="Location established",this.location_bk=t),setTimeout((()=>{this.snackbar.status=!1,this.background_count++,this.$forceUpdate()}),2500)},getTimeDate(){const t=new Date;this.current.time=t.toLocaleTimeString("en-GB",{hour12:!1}),this.current.date=t.toLocaleDateString("en-CA"),this.display.time=t.toLocaleTimeString("en-US",{hour12:!0,hour:"2-digit",minute:"2-digit",second:"2-digit"}),this.display.date=t.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"long",day:"numeric"})},async fetchUserLocations(){let t=[],e=await this.$api.masterselect({table_name:"spottv2.user_loc_view",having:{username:this.session_user.username}});e.length>0&&(e.forEach((e=>{t.push(e.longitude+":"+e.latitude+":"+e.radius)})),this.user_location=t.join(","),await this.$storage.setItem("session-location",this.user_location))},async entertransaction(){try{await this.$function.checkperms();let t=await this.$function.getNet(),e=await this.$function.checknet(),a=await this.$function.validateSettings(),s=await this.$function.getLocation();if(s.status?this.location=s:this.location=this.location_bk,0==a.status)return void this.$function.showAlert({header:"Warning",message:a.message});if(!this.checkIfWithinLocation(this.location.longitude,this.location.latitude))return void this.$function.showAlert({header:"Warning",message:"You are not within the allowed locations."});let i=await this.openCamera();if(!i.status)return void this.$function.showAlert({header:"Warning",message:"Image captured failed"});let n={};if(n.id=this.$function.generateUniqueId(),n.trxdatedb=this.current.date,n.username=this.session_user.username,n.trxdate=(new Date).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}),n.trxtime=this.current.time,n.trxmode=this.trxmodetype,n.timestamp=String(new Date),n.longitude=s.longitude,n.latitude=s.latitude,n.platform=`${this.user_device.model}=>${this.user_device.identifier}`,n.picture=i,n.fileName="",n.pathName="",n.status=0,t.connected&&e){let t={path_folder:"uploads/spott/images/"+this.session_user.username,max_size:15e3,base64data:i.base64String.replace("data:image/jpeg;base64,","")},e=this.$api.fileUpload(t);1==e.status&&(n.picture="UPLOADED",n.fileName=e.file_name,n.pathName=e.file_path)}await this.localSaveAttlogs(n)}catch(t){console.log(t)}},async localSaveAttlogs(t){this.attlogs.push(t),await this.$storage.setItem("session-location",this.attlogs)},async openCamera(){let t={status:!1,base64String:"",message:""};try{let e=await x.getPhoto({resultType:D.Base64,source:L.Camera}),a=await this.$function.dataUrlToBlob("data:image/jpeg;base64,"+e.base64String),s=await this.$function.compressImage(a,.3),i=await this.$function.convertBlobToBase64(s);t.base64String=i,t.status=!0,t.message="Image captured successfully"}catch(e){t.status=!1,t.message=e}return t},checkIfWithinLocation(t,e){if("0"==this.session_user.geoFence||"1"==this.session_user.disableLocation)return!0;{let a=0;return this.allowedLocations.forEach((s=>{this.$function.computeDistance(s.lat,s.long,e,t)<=parseFloat(s.radius)&&(a+=1)})),a>0}}},computed:{transferbtn(){return this.attlogs.filter((t=>"0"==t.upload_status)).length>0},transfercount(){return this.attlogs.filter((t=>"0"==t.upload_status)).length},allowedLocations(){let t=this.user_location?this.user_location.split(","):[],e=[];return t.forEach((t=>{let a=t.split(":");e.push({long:a[0],lat:a[1],radius:a[2]})})),e}},watch:{async background_count(){if(this.background_count>0){let t=await this.$function.getLocation();1==t.status&&(this.location_bk=t),setTimeout((()=>{this.background_count++}),1e4)}}}},F={class:"d-grid"},q={class:"d-flex pt-1 mx-3",style:{gap:"10px"}},G=(t=>(j("data-v-4f198ab8"),t=t(),O(),t))((()=>B("div",{class:"",style:{"font-size":"16px !important","letter-spacing":".75px"}},[B("tr",{class:"bold-text"},[B("td",null,"IN:"),B("td",null,"   01/01/2025"),B("td",null,"   07:59:21")]),B("tr",{class:"bold-text"},[B("td",null,"OUT:"),B("td",null,"  01/01/2025"),B("td",null,"  17:12:02")])],-1)));t("default",a(W,[["render",function(t,e,a,s,i,n){const o=S("ion-toast"),l=S("ion-card-title"),r=S("IonLabel"),c=S("ion-button"),d=S("ion-card-content"),u=S("IonCard"),h=S("ion-input"),m=S("ion-icon"),g=S("ion-item"),p=S("ion-list"),f=S("ion-content"),b=S("IonPage");return T(),$(b,{class:"pt-4"},{default:C((()=>[U(o,{class:A(i.snackbar.type),style:{scale:"0.98"},position:"top","is-open":i.snackbar.status,onDidDismiss:e[0]||(e[0]=t=>i.snackbar.status=!1),message:i.snackbar.message},null,8,["class","is-open","message"]),U(f,null,{default:C((()=>[U(u,{class:"py-4 mx-2",color:"dark",style:{"border-radius":"25px"}},{default:C((()=>[U(l,{class:"subheader"},{default:C((()=>[z("SPOTT")])),_:1}),U(d,{class:"justify-center pa-0"},{default:C((()=>[B("div",F,[U(r,{class:"header white-text"},{default:C((()=>[z(N(i.display.time),1)])),_:1}),U(r,{class:"subheader white-text"},{default:C((()=>[z(N(i.display.date),1)])),_:1}),U(c,{class:"px-5 pt-4 main bold-text",onClick:e[1]||(e[1]=t=>n.entertransaction()),disabled:!i.btnvalid,expand:"full",size:"large",shape:"round"},{default:C((()=>[z(N("0"==i.trxmodetype?"Time In":"Time Out"),1)])),_:1},8,["disabled"])])])),_:1})])),_:1}),B("div",q,[U(h,{modelValue:i.display.datefrom,"onUpdate:modelValue":e[2]||(e[2]=t=>i.display.datefrom=t),readonly:!0,onClick:e[3]||(e[3]=e=>t.pickDate(1)),class:"dateInput pt-2",label:"Date From",fill:"outline",size:"small","label-placement":"stacked"},null,8,["modelValue"]),U(h,{modelValue:i.display.dateto,"onUpdate:modelValue":e[4]||(e[4]=t=>i.display.dateto=t),readonly:!0,onClick:e[5]||(e[5]=e=>t.pickDate(2)),class:"dateInput pt-2",label:"Date To",fill:"outline","label-placement":"stacked"},null,8,["modelValue"])]),U(c,{onClick:e[6]||(e[6]=e=>t.transferlogs()),disabled:!n.transferbtn,class:"pt-2 mx-4",expand:"full",color:"primary",shape:"round"},{default:C((()=>[z("Transfer Logs ("+N(n.transfercount)+")",1)])),_:1},8,["disabled"]),U(p,{style:{"min-height":"30vh","max-height":"42vh","overflow-y":"scroll"}},{default:C((()=>[(T(),E(V,null,P(10,(e=>U(g,{key:e,class:"py-2 ps-3"},{default:C((()=>[G,U(c,{class:"ma-auto",onClick:a=>t.viewLogs(e),id:"open-dialog",expand:"block",shape:"round",dark:""},{default:C((()=>[U(m,{class:"px-2",icon:i.eye,size:"default",color:"white"},null,8,["icon"])])),_:2},1032,["onClick"])])),_:2},1024))),64))])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-4f198ab8"]]))}}}));
