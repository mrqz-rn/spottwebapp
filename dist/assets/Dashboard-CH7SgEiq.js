import{_ as L,I as C,x as S,y as T,z as $,e as U,A,f as B,d as z,b as N,B as V,C as P,D as E,E as F,F as O,G as W,H as j,J as q,K as G,L as M,M as R,N as H,O as J,P as K,Q,c as Y,w as l,r,o as b,m as i,n as X,p as m,a as u,t as p,R as Z,S as tt,T as et,q as at,s as st}from"./index-ygXwHGmL.js";const ot={components:{IonPage:C,IonToast:S,IonContent:T,IonCard:$,IonCardTitle:U,IonCardContent:A,IonLabel:B,IonInput:z,IonButton:N,IonSpinner:V,IonList:P,IonModal:E,IonTextarea:F,IonItem:O,IonIcon:W},data(){return{eye:j,book:q,camera:G,save:M,close:R,arrowUndo:H,snackbar:{status:!1,type:"success",message:"test"},session_user:{},user_location:"",user_device:"",attlogs:[],display:{time:"00:00",date:"00/00/0000",datefrom:"00/00/0000",dateto:"00/00/0000"},current:{time:"00:00",date:"00/00/0000",datefrom:"00/00/0000",dateto:"00/00/0000"},btnvalid:!0,trxmodetype:0,background_count:0,location_bk:{latitude:0,longitude:0},location:{latitude:0,longitude:0}}},beforeCreate(){setInterval(()=>{this.getTimeDate()},1e3)},async mounted(){const t=new Date;t.setDate(t.getDate()-15),this.current.datefrom=t.toLocaleDateString("en-CA"),this.display.datefrom=this.$function.formatDate(t.toLocaleDateString("en-CA")),this.current.dateto=new Date().toLocaleDateString("en-CA"),this.display.dateto=this.$function.formatDate(new Date().toLocaleDateString("en-CA")),this.user_device=await this.$function.getDeviceInfo(),await this.initialize(),this.user_location||(console.log("test"),await this.fetchUserLocations())},methods:{async initialize(){this.session_user=await this.$function.getUser(),this.user_location=await this.$function.UserLocation(),this.snackbar.status=!0,this.snackbar.type="info",this.snackbar.message="Initializing location...";let t=await this.$function.getLocation();t.status==!0&&(this.snackbar.type="success",this.snackbar.message="Location established",this.location_bk=t),setTimeout(()=>{this.snackbar.status=!1,this.background_count++,this.$forceUpdate()},2500)},getTimeDate(){const t=new Date;this.current.time=t.toLocaleTimeString("en-GB",{hour12:!1}),this.current.date=t.toLocaleDateString("en-CA"),this.display.time=t.toLocaleTimeString("en-US",{hour12:!0,hour:"2-digit",minute:"2-digit",second:"2-digit"}),this.display.date=t.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"long",day:"numeric"})},async fetchUserLocations(){let t=[],e=await this.$api.masterselect({table_name:"spottv2.user_loc_view",having:{username:this.session_user.username}});e.length>0&&(e.forEach(o=>{t.push(o.longitude+":"+o.latitude+":"+o.radius)}),this.user_location=t.join(","),await this.$storage.setItem("session-location",this.user_location))},async entertransaction(){try{await this.$function.checkperms();let t=await this.$function.getNet(),e=await this.$function.checknet(),o=await this.$function.validateSettings(),n=await this.$function.getLocation();if(n.status?this.location=n:this.location=this.location_bk,o.status==!1){this.$function.showAlert({header:"Warning",message:o.message});return}if(!this.checkIfWithinLocation(this.location.longitude,this.location.latitude)){this.$function.showAlert({header:"Warning",message:"You are not within the allowed locations."});return}let d=await this.openCamera();if(!d.status){this.$function.showAlert({header:"Warning",message:"Image captured failed"});return}let a={};if(a.id=this.$function.generateUniqueId(),a.trxdatedb=this.current.date,a.username=this.session_user.username,a.trxdate=new Date().toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}),a.trxtime=this.current.time,a.trxmode=this.trxmodetype,a.timestamp=String(new Date),a.longitude=n.longitude,a.latitude=n.latitude,a.platform="".concat(this.user_device.model,"=>").concat(this.user_device.identifier),a.picture=d,a.fileName="",a.pathName="",a.status=0,t.connected&&e){let f={path_folder:"uploads/spott/images/"+this.session_user.username,max_size:15e3,base64data:d.base64String.replace("data:image/jpeg;base64,","")},h=this.$api.fileUpload(f);h.status==!0&&(a.picture="UPLOADED",a.fileName=h.file_name,a.pathName=h.file_path)}await this.localSaveAttlogs(a)}catch(t){console.log(t)}},async localSaveAttlogs(t){this.attlogs.push(t),await this.$storage.setItem("session-location",this.attlogs)},async openCamera(){let t={status:!1,base64String:"",message:""};try{let e=await J.getPhoto({resultType:K.Base64,source:Q.Camera}),o=await this.$function.dataUrlToBlob("data:image/jpeg;base64,"+e.base64String),n=await this.$function.compressImage(o,.3),s=await this.$function.convertBlobToBase64(n);t.base64String=s,t.status=!0,t.message="Image captured successfully"}catch(e){t.status=!1,t.message=e}return t},checkIfWithinLocation(t,e){if(this.session_user.geoFence=="0"||this.session_user.disableLocation=="1")return!0;{let o=0;return this.allowedLocations.forEach(n=>{this.$function.computeDistance(n.lat,n.long,e,t)<=parseFloat(n.radius)&&(o=o+1)}),o>0}}},computed:{transferbtn(){return this.attlogs.filter(e=>e.upload_status=="0").length>0},transfercount(){return this.attlogs.filter(e=>e.upload_status=="0").length},allowedLocations(){let t=this.user_location?this.user_location.split(","):[],e=[];return t.forEach(o=>{let n=o.split(":");e.push({long:n[0],lat:n[1],radius:n[2]})}),e}},watch:{async background_count(){if(this.background_count>0){let t=await this.$function.getLocation();t.status==!0&&(this.location_bk=t),setTimeout(()=>{this.background_count++},1e4)}}}},nt=t=>(at("data-v-4f198ab8"),t=t(),st(),t),it={class:"d-grid"},lt={class:"d-flex pt-1 mx-3",style:{gap:"10px"}},rt=nt(()=>u("div",{class:"",style:{"font-size":"16px !important","letter-spacing":".75px"}},[u("tr",{class:"bold-text"},[u("td",null,"IN:"),u("td",null,"   01/01/2025"),u("td",null,"   07:59:21")]),u("tr",{class:"bold-text"},[u("td",null,"OUT:"),u("td",null,"  01/01/2025"),u("td",null,"  17:12:02")])],-1));function ct(t,e,o,n,s,d){const a=r("ion-toast"),f=r("ion-card-title"),h=r("IonLabel"),g=r("ion-button"),y=r("ion-card-content"),w=r("IonCard"),_=r("ion-input"),I=r("ion-icon"),k=r("ion-item"),v=r("ion-list"),D=r("ion-content"),x=r("IonPage");return b(),Y(x,{class:"pt-4"},{default:l(()=>[i(a,{class:X(s.snackbar.type),style:{scale:"0.98"},position:"top","is-open":s.snackbar.status,onDidDismiss:e[0]||(e[0]=c=>s.snackbar.status=!1),message:s.snackbar.message},null,8,["class","is-open","message"]),i(D,null,{default:l(()=>[i(w,{class:"py-4 mx-2",color:"dark",style:{"border-radius":"25px"}},{default:l(()=>[i(f,{class:"subheader"},{default:l(()=>[m("SPOTT")]),_:1}),i(y,{class:"justify-center pa-0"},{default:l(()=>[u("div",it,[i(h,{class:"header white-text"},{default:l(()=>[m(p(s.display.time),1)]),_:1}),i(h,{class:"subheader white-text"},{default:l(()=>[m(p(s.display.date),1)]),_:1}),i(g,{class:"px-5 pt-4 main bold-text",onClick:e[1]||(e[1]=c=>d.entertransaction()),disabled:!s.btnvalid,expand:"full",size:"large",shape:"round"},{default:l(()=>[m(p(s.trxmodetype=="0"?"Time In":"Time Out"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1}),u("div",lt,[i(_,{modelValue:s.display.datefrom,"onUpdate:modelValue":e[2]||(e[2]=c=>s.display.datefrom=c),readonly:!0,onClick:e[3]||(e[3]=c=>t.pickDate(1)),class:"dateInput pt-2",label:"Date From",fill:"outline",size:"small","label-placement":"stacked"},null,8,["modelValue"]),i(_,{modelValue:s.display.dateto,"onUpdate:modelValue":e[4]||(e[4]=c=>s.display.dateto=c),readonly:!0,onClick:e[5]||(e[5]=c=>t.pickDate(2)),class:"dateInput pt-2",label:"Date To",fill:"outline","label-placement":"stacked"},null,8,["modelValue"])]),i(g,{onClick:e[6]||(e[6]=c=>t.transferlogs()),disabled:!d.transferbtn,class:"pt-2 mx-4",expand:"full",color:"primary",shape:"round"},{default:l(()=>[m("Transfer Logs ("+p(d.transfercount)+")",1)]),_:1},8,["disabled"]),i(v,{style:{"min-height":"30vh","max-height":"42vh","overflow-y":"scroll"}},{default:l(()=>[(b(),Z(et,null,tt(10,c=>i(k,{key:c,class:"py-2 ps-3"},{default:l(()=>[rt,i(g,{class:"ma-auto",onClick:ut=>t.viewLogs(c),id:"open-dialog",expand:"block",shape:"round",dark:""},{default:l(()=>[i(I,{class:"px-2",icon:s.eye,size:"default",color:"white"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)),64))]),_:1})]),_:1})]),_:1})}const ht=L(ot,[["render",ct],["__scopeId","data-v-4f198ab8"]]);export{ht as default};
